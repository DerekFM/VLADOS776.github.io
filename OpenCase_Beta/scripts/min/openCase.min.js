var caseId=0;var caseOpening=false;$(".openCase").attr("disabled",null);$(document).on("click",".case",function(){$("#rank-popup").css("display","none");$("#special-popup").css("display","none");caseId=this.id;if(typeof cases[caseId].minRank!="undefined"&&getRank().id<getRankByName(cases[caseId].minRank).id){needRank=getRankByName(cases[caseId].minRank);$("#rank-popup").css("display","block");$("#rank").html('<img src="'+needRank.img+'" style="width: 50px;">');return false}if(cases[caseId].type=="Special"){if(parseInt(getStatistic("specialCases",0))>=cases[caseId].casesToOpen){window.location="open.html?caseId="+caseId}else{$("#special-popup").css("display","block");var a=cases[caseId].casesToOpen-parseInt(getStatistic("specialCases",0));$("#special").text(a);$("#showVideoAd").data();$(".js-secretField").text(caseId)}}else{window.location="open.html?caseId="+caseId}});$(document).on("click","#closePopup",function(){$(".popup").css("display","none")});function fillCarusel(f){var h=cases[f].weapons.filter(function(k){return k.rarity=="consumer"}).mul(7).shuffle();var e=cases[f].weapons.filter(function(k){return k.rarity=="industrial"}).mul(7).shuffle();var c=cases[f].weapons.filter(function(k){return k.rarity=="milspec"}).mul(5).shuffle();var b=cases[f].weapons.filter(function(k){return k.rarity=="restricted"}).mul(5).shuffle();var a=cases[f].weapons.filter(function(k){return k.rarity=="classified"}).mul(4).shuffle();var j=cases[f].weapons.filter(function(k){return k.rarity=="covert"}).mul(1).shuffle();var i=cases[f].weapons.filter(function(k){return k.rarity=="rare"}).mul(1).shuffle();if((Math.rand(0,10)>7)&&(i.length+j.length+b.length+c.length!=0)){a=[]}if((Math.rand(0,10)>5)&&(i.length+a.length+b.length+c.length!=0)){j=[]}if((Math.rand(0,10)>3)&&(j.length+a.length+b.length+c.length!=0)){i=[]}if(h==undefined){var g=e.concat(c,b,a,j,i).shuffle().shuffle().shuffle()}else{var g=h.concat(e,c,b,a,j,i).shuffle().shuffle().shuffle()}var d="";while(g.length<=(winNumber+3)){g=g.concat(c,b,a,j).shuffle().shuffle()}if(g.length>winNumber+3){g.splice(winNumber+3,g.length-(winNumber+3))}g.forEach(function(o,m){var k=getImgUrl(o.img);var n=o.type;if(n.indexOf("|")!=-1){n=n.split("|")[1]}n=(n.indexOf("Сувенир")!=-1&&Settings.language!="RU")?n.replace("Сувенир","Souvenir"):n;if(o.rarity=="rare"){n="★ Rare Special Item ★";l="&nbsp;";k="../images/Weapons/rare.png"}else{var l=getSkinName(o.skinName,Settings.language)}if(o.rarity=="rare"){k="../images/Weapons/rare.png"}d+='<div class="weapon"><img src="'+k+'" /><div class="weaponInfo '+o.rarity+'"><span class="type">'+n+"<br>"+l+"</span></div></div>"});win=g[winNumber];$(".casesCarusel").html(d);$(".casesCarusel").css("margin-left","0px")}$(document).on("click",".openCase",function(){$(".weapons").scrollTop(0);if(caseOpening||$(".openCase").text()==Localization.openCase2.opening[Settings.language]){return false}$(".win").slideUp("slow");if($(".openCase").text()==Localization.openCase2.tryAgain[Settings.language]){backToZero()}$(".openCase").text(Localization.openCase2.opening[Settings.language]);$(".openCase").attr("disabled","disabled");var c=127*winNumber;var b=131;var g=0,e=0;var f=(Settings.drop)?5000:10000;$(".casesCarusel").animate({marginLeft:-1*Math.rand(c-50,c+60)},{duration:f,easing:"easeOutCubic",start:function(){if(Settings.sounds){caseOpenAudio.play()}var d=win.type;var a=getSkinName(win.skinName,Settings.language);win.name=a;var k=ifStatTrak(d,win.name);var j=getItemQuality()[Settings.language=="RU"?1:0];caseOpening=true;if(d.indexOf("|")!=-1){d=d.split("|")[1]}d=(d.indexOf("Сувенир")!=-1&&Settings.language!="RU")?d.replace("Сувенир","Souvenir"):d;var h=getPrice(d,a,j,k);win.type=d;var i=0;while(h==0){j=getItemQuality()[Settings.language=="RU"?1:0];h=getPrice(d,a,j,k);if(i==15){break}i++}$(".win_price").html(h+"$");if(h==0){getMarketPrice(d,a,j,k,".win_price")}if(k){d="StatTrak™ "+d}$(".win_name").html(d+" | "+a);$(".win_quality").html(j);$(".win_img").attr("src",getImgUrl(win.img,1));$(".openCase").attr("disabled","disabled");win.statTrak=k;win.quality=j;win.price=h},progress:function(d,a){if(Settings.sounds){progress_animate=Math.round(100*a),e=parseInt(parseInt($(".casesCarusel").css("marginLeft").replace(/[^0-9.]/g,"")-b/2)/b),e>g&&(caseScrollAudio.pause(),caseScrollAudio.currentTime=0,caseScrollAudio.play(),g++)}},complete:function(){$("#opened").text(parseInt($("#opened").text())+1);var h=parseFloat($(".win_price").html());if(isNaN(h)){h=0}win.price=h;win["new"]=true;inventory.push(win);if(isAndroid()){saveWeapon(win)}else{saveInventory()}if(Settings.sounds){caseCloseAudio.play()}$(".openCase").text(Localization.openCase2.tryAgain[Settings.language]);$(".win").slideDown("fast");caseOpening=false;$(".openCase").attr("disabled",null);$(".weapons").scrollTop(185);changePoints(1);var a=$("#youCanWin span").text();statisticPlusOne("case-"+a);statisticPlusOne("weapon-"+win.rarity);if(win.statTrak){statisticPlusOne("statTrak")}var k=parseURLParams(window.location.href);if(typeof k!="undefined"){a=k.caseId[0];var j=0;try{j=parseInt(k.fromAd[0])}catch(i){}if(cases[a].type=="Special"){if(!j){var d=getStatistic("specialCases",0)-cases[a].casesToOpen;d=(d<0)?0:d;saveStatistic("specialCases",d)}if(getStatistic("specialCases",0)<cases[a].casesToOpen){$(".openCase").attr("disabled","disabled")}}else{statisticPlusOne("specialCases")}}else{statisticPlusOne("specialCases")}},always:function(){caseOpening=false}})});function backToZero(){var a=131;var b=0,c=0;$(".casesCarusel").animate({marginLeft:0},{duration:1000,easing:"easeOutQuad",start:function(){fillCarusel(caseId)},always:function(){caseOpening=false}})}$(document).on("click",".closeCase",function(){window.location="cases.html";caseOpening=false});