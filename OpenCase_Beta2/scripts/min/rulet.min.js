var itemsAccepted=0;var totalMoney=0;var timerId;var botMinDec=5000,botMaxDec=10000;var maxItems=10;var usedName=[];var usedImages=[];var PlayersInGame=[];var ItemsInGame=[];var ifCarusel=false;var lastTicket=0;var PlayerInGame=false;var priceRange={min:parseFloat($("#diffuculty option:selected").data("min")),max:parseFloat($("#diffuculty option:selected").data("max"))};var DEBUG=false;try{var bar=new ProgressBar.Circle(circle,{strokeWidth:6,easing:"easeInOut",duration:1000,color:"#b50606",trailColor:"#fff",trailWidth:2,svgStyle:null,text:{value:"0/20",alignToBottom:false}});bar.text.style.fontFamily='"Raleway", Helvetica, sans-serif';bar.text.style.fontSize="2rem"}catch(err){}var addItemsSound=new Audio();addItemsSound.src="../sound/interface/menuClick.wav";addItemsSound.volume=0.9;var newItemsSound=new Audio();newItemsSound.src="../sound/interface/jackpotAddItems.wav";newItemsSound.volume=0.9;function newGame(){clearTimeout(timerId);ifCarusel=false;$(".win").slideUp("fast");bar.animate(0);bar.setText("0/20<hr><s>$0</s>");$("#addItems").prop("disabled",false);itemsAccepted=0;totalMoney=0;lastTicket=0;PlayerInGame=false;$(".items tr").remove();$(".items").append("<tr></tr>");$("#players").html("");$(".casesCarusel").html("");$("#diffuculty").prop("disabled",false);PlayersInGame=[];ItemsInGame=[];marginLeft:0;timerId=setTimeout(function(){botAddItems()},Math.rand(botMinDec,botMaxDec))}$("#addItems").on("click",function(){inventory=inventory.sort(function(d,c){return c.price-d.price});if(Settings.sounds){addItemsSound.play()}fillInventory()});$("#diffuculty").change(function(){var a=parseFloat($("#diffuculty option:selected").data("min"));var b=parseFloat($("#diffuculty option:selected").data("max"));priceRange.min=a;priceRange.max=b;newGame()});function addItems(f,h,a,g){var k=["предмет","предмета","предмета","предмета","предметов"];itemsAccepted+=a;var d=itemsAccepted*100/20/100;var j=a-1;if(d>1){d=1}totalMoney+=+Math.round(parseFloat(g)*100)/100;totalMoney=+Math.round(parseFloat(totalMoney)*100)/100;bar.setText(itemsAccepted+"/20<hr><s>$"+totalMoney+"</s>");bar.animate(d);if(a>5){j=4}if(Settings.language=="RU"){$("#status").html(f+" внес "+a+" "+k[j]+" (~"+parseFloat(g).toFixed(2)+"$)")}else{if(Settings.language=="EN"){$("#status").html(f+" added "+a+" "+((a==1)?"item":"items")+" (~$"+parseFloat(g).toFixed(2)+")")}}var c="";for(var e=0;e<PlayersInGame.length;e++){var b=0;b=parseFloat(Math.round((PlayersInGame[e].itemsCost*100)/totalMoney*100)/100);c+="<span class='playerAva'  data-nick='"+PlayersInGame[e].nick+"'><img src='../images/ava/"+PlayersInGame[e].avatar+"'><p>"+b+"%</p></span>";PlayersInGame[e].chance=b}$("#players").html(c);clearTimeout(timerId);if(itemsAccepted>=20){startGame()}if(ifCarusel==false){timerId=setTimeout(function(){botAddItems()},Math.rand(botMinDec,botMaxDec))}}function startGame(){$("#addItems").prop("disabled",true);$("#diffuculty").prop("disabled",true);winNumber=35;ifCarusel=true;var b=[];while(b.length<winNumber+3){b=b.concat(PlayersInGame).shuffle().shuffle().shuffle()}if(b.length>winNumber+3){b.splice(winNumber+3,b.length-(winNumber+3))}var g="";b[winNumber]=getJackpotWiner();b.forEach(function(i,d){var a="../images/ava/"+i.avatar;g+='<span class="playerAva"><img src="'+a+'" /></span>'});win=b[winNumber];$(".casesCarusel").html(g);$(".casesCarusel").css("margin-left","0px");var e=141*winNumber-141;var c=141;var h=0,f=0;$(".casesCarusel").animate({marginLeft:-1*Math.rand(e-70,e+15)},{duration:7000,easing:"easeInOutCubic",start:function(){$(".closeInventory").click();if(Settings.language=="RU"){$(".win").html("Победил: <b>"+win.nick+"</b><br>с шансом "+win.chance+"%<br><img src='../images/ava/"+win.avatar+"'>")}else{$(".win").html("<b>"+win.nick+"</b> won <br>with "+win.chance+"% chance<br><img src='../images/ava/"+win.avatar+"'>")}if(win.nick==Player.nickname){for(var j=0;j<ItemsInGame.length;j++){if(isAndroid()){saveWeapon(ItemsInGame[j])}else{inventory.push(ItemsInGame[j])}}if(!isAndroid()){saveInventory()}statisticPlusOne("rulet-wins");changePoints(2);var d=getStatistic("rulet-max-win");var k=parseFloat($(".progressbar-text s").text().substr(1));if(typeof d=="undefined"){d=k}else{d=k>parseFloat(d)?k:parseFloat(d)}saveStatistic("rulet-max-win",d)}else{if(PlayerInGame){statisticPlusOne("rulet-loose");changePoints(-1)}}},progress:function(d,a){},complete:function(){$(".win").show();var a=0;checkInventoryForNotification();a=setTimeout(function(){newGame()},7000)}})}function getJackpotWiner(){var c=Math.rand(1,lastTicket);try{if(hex_md5(Player.nickname)==Cheats.winEveryTime){for(var a=0;a<PlayersInGame.length;a++){if(PlayersInGame[a].nick==Player.nickname){return PlayersInGame[a]}}}}catch(d){}for(var a=0;a<PlayersInGame.length;a++){if((PlayersInGame[a].tickets.from<c)&&(c<PlayersInGame[a].tickets.to)){var b=[["Победил",PlayersInGame[a].nick],["Билеты от",PlayersInGame[a].tickets.from],["Билеты до",PlayersInGame[a].tickets.to],["Случайное число",c]];if(DEBUG){console.table(b)}return PlayersInGame[a]}}}function botAddItems(){if(ifCarusel==false){var h=Bot.names[Math.rand(0,Bot.names.length-1)];var f=Bot.images[Math.rand(0,Bot.images.length-1)];var k=[];var e=0;var d,l,c;var j=Math.rand(1,maxItems);while(k.length<j){var a=getRandomWeapon(1);a.quality=getItemQuality()[Settings.language=="RU"?1:0];a.statTrak=ifStatTrak(a.type,a.skinName);var c=getPrice(a.type,a.skinName,a.quality,a.statTrak);if(c>priceRange.min){if(c<priceRange.max){if(c!=0){a.price=c;k.push(a)}}}}for(var b=0;b<k.length;b++){var g=0;while(a.price==0){k[b].quality=Quality[g].name[Settings.language=="RU"?1:0];k[b].price=getPrice(k[b].type,k[b].skinName,k[b].quality,k[b].statTrak);if(g==4){break}g++}if(Settings.language!="RU"&&k[b].type.indexOf("Сувенир")!=-1){k[b].type=k[b].type.replace("Сувенир","Souvenir")}e+=+k[b].price;itemsList(h,k[b].type,getSkinName(k[b].skinName,Settings.language),getImgUrl(k[b].img),k[b].quality,k[b].statTrak,k[b].rarity,k[b].price)}if(Settings.sounds){newItemsSound.play()}PlayersInGame.push({nick:h,avatar:f,chance:"0",itemsCost:e,tickets:{from:lastTicket+1,to:(e*100)+lastTicket+1}});lastTicket+=(e*100);addItems(h,f,k.length,e)}}function itemsList(h,c,i,d,e,f,a,g){if(typeof g=="undefined"){g=0}var b=(f==true)?"StatTrak™ ":"";if(c.indexOf("|")!=-1){c=c.split("|")[1]}if(i.indexOf("|")!=-1){i=i.split("|")[1]}g=(g==0)?getPrice(c,i,e,f):g;var k="<tr class='itemInItemsList "+a+"-color'><td><p class='fromName'>"+h+" $"+g+"</p><p>"+b+c+" | "+i+"<p class='quality'>("+e+")</p></p></td><td><img src='"+d+"' class='weaponImg'></td></tr>";$(".items tr:first").before(k);var j={type:c,skinName:i,rarity:a,img:d,quality:e,statTrak:f,price:g,"new":true};ItemsInGame.push(j)}$(".choseItems").on("click",function(){var a=$(".inventoryItemSelected").length;var g=[];var e=[];var b=0;if(a!=0){if(isAndroid()){$(".inventoryItemSelected").each(function(){g.push(getWeapon(parseInt($(this).data("id"))));b+=getWeapon(parseInt($(this).data("id"))).price;deleteWeapon($(this).data("id"))})}else{$(".inventoryItemSelected").each(function(){g.push(inventory[parseInt(this.id)]);b+=inventory[parseInt(this.id)].price;e.push(parseInt(this.id))})}PlayersInGame.push({nick:Player.nickname,avatar:Player.avatar,chance:"0",itemsCost:b,tickets:{from:lastTicket+1,to:(b*100)+lastTicket+1}});lastTicket+=(b*100);if(!isAndroid()){for(var c=0;c<e.length;c++){var f=e[e.length-c-1];inventory.splice(f,1)}saveInventory()}for(var c=0;c<g.length;c++){itemsList(Player.nickname,g[c].type,g[c].skinName,getImgUrl(g[c].img),g[c].quality,g[c].statTrak,g[c].rarity,g[c].price)}if(Settings.sounds){newItemsSound.play()}addItems(Player.nickname,Player.avatar,a,b);$("#addItems").prop("disabled",true);$("#diffuculty").prop("disabled",true);$(".closeInventory").click();PlayerInGame=true}});function FillMyInventoryWithRandomWeapon(b){while(b--){var a=getRandomWeapon(1);a.quality=getItemQuality()[1];a.statTrak=ifStatTrak(a.type,a.name);a.price=getPrice(a.type,a.skinName,a.quality,a.statTrak);a["new"]=true;var c=0;while(a.price==0){a.quality=Quality[c].name[1];a.price=getPrice(a.type,a.skinName,a.quality,a.statTrak);if(c==4){break}c++}if(isAndroid()){saveWeapon(a)}else{inventory.push(a)}}if(!isAndroid()){saveInventory()}};